#!/usr/bin/env python
#
# This software is licensed under the terms of the GNU General Public
# License version 2, as published by the Free Software Foundation, and
# may be copied, distributed, and modified under those terms.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# this script is used to generate 'android/avd/hw-config.h' by
# parsing 'android/avd/hardware-properties.ini'
#
#
import  sys, os, string, re

targetHeader = """\
/* this file is automatically generated from 'source.properties'
 * DO NOT EDIT IT. To re-generate it, use:
 * android/scripts/gen-emulator-version-header.py <source.properties path> <target .h path>
 */
"""

# locate source and target
programDir = os.path.dirname(sys.argv[0])
if len(sys.argv) != 3:
    print "Usage: %s source target\n" % os.path.basename(sys.argv[0])
    sys.exit(1)

sourceFile = sys.argv[1]
targetFile = sys.argv[2]

out = open(targetFile,"w")
print >>out, targetHeader

for line in open(sourceFile):
    line = line.strip()
    # ignore empty lines and comments
    if len(line) == 0 or line[0] in ";#":
        continue
    key, value = line.split('=')

    key   = key.strip()
    value = value.strip()

    if key == 'Pkg.Revision':
        revisionDigits = map(int, value.split("."))
        if len(revisionDigits) == 3:
            print >>out, "#define ANDROID_EMU_MAJOR_VERSION %d" % (revisionDigits[0])
            print >>out, "#define ANDROID_EMU_MINOR_VERSION %d" % (revisionDigits[1])
            print >>out, "#define ANDROID_EMU_PATCH_VERSION %d" % (revisionDigits[2])

print >>out, "/* end of auto-generated file */"
